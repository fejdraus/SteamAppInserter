const MILLENNIUM_IS_CLIENT_MODULE=!0,pluginName="steam-app-adder";function InitializePlugins(){var e,n;let t;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(n=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(n[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(t||(t={}));let o=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],a=`Millennium.Internal.IPC.[${pluginName}]`;const i={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};function r(e,n,o){return MILLENNIUM_BACKEND_IPC.postMessage(t.CallServerMethod,{pluginName:e,methodName:"__builtins__.__update_settings_value__",argumentList:{name:n,value:o}})}o.ignoreProxyFlag=!1,async function(){for(;"undefined"==typeof MainWindowBrowserManager;)await new Promise(e=>setTimeout(e,0));MainWindowBrowserManager?.m_browser?.on("message",(e,n)=>{if(e!==a)return;const{name:t,value:i}=JSON.parse(n);o.ignoreProxyFlag=!0,o.settingsStore[t]=i,r(pluginName,t,i),o.ignoreProxyFlag=!1})}();const l=e=>new Proxy(e,{set(e,n,t){if(!(n in e))throw new TypeError(`Property ${String(n)} does not exist on plugin settings`);const l=i[e[n].type],s=e[n]?.range;if(l.includes("number")&&"number"==typeof t&&(s&&(t=function(e,n,t){return Math.max(n,Math.min(t,e))}(t,s[0],s[1])),t||(t=0)),!l.includes(typeof t))throw new TypeError(`Expected ${l.join(" or ")}, got ${typeof t}`);return e[n].value=t,((e,n)=>{o.ignoreProxyFlag||(r(pluginName,e,n),"undefined"!=typeof MainWindowBrowserManager&&MainWindowBrowserManager?.m_browser?.PostMessage(a,JSON.stringify({name:e,value:n})))})(String(n),t),!0},get:(e,n)=>"__raw_get_internals__"===n?e:n in e?e[n].value:void 0});o.DefinePluginSetting=l,o.settingsStore=l({})}InitializePlugins();const __call_server_method__=(e,n)=>Millennium.callServerMethod(pluginName,e,n),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,n){"use strict";const t=__wrapped_callable__("Backend.deletelua");__wrapped_callable__("Backend.receive_frontend_message");const o=__wrapped_callable__("Backend.restart");let a="";async function i(e,n,t=100){for(;;){const o=e.querySelector(n);if(o)return o;await new Promise(e=>setTimeout(e,t))}}async function r(){"complete"===document.readyState&&document.querySelector("#root")||("complete"!==document.readyState&&await new Promise(e=>{const n=()=>{"complete"===document.readyState&&(document.removeEventListener("readystatechange",n),e())};document.addEventListener("readystatechange",n)}),document.querySelector("#root")||await new Promise(e=>{const n=new MutationObserver(()=>{document.querySelector("#root")&&(n.disconnect(),e())});n.observe(document.body,{childList:!0,subtree:!0})}))}return e.default=async function(){for(;;){for(;void 0===window.MainWindowBrowserManager;)await n.sleep(100);for(;!MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/app/");)await n.sleep(100);if(await n.sleep(20),a===MainWindowBrowserManager.m_lastLocation.pathname||!MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/app/")){var e=g_PopupManager.GetExistingPopup("SP Desktop_uid0").window.document;const n=e.evaluate("//span[normalize-space(text())='Delete']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(null!=n.singleNodeValue){const t=e.evaluate("//span[normalize-space(text())='Support']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(null!=t.singleNodeValue){const e=Number(t.singleNodeValue.parentElement.parentElement.parentElement.style.left.replace("px",""))+120;n.singleNodeValue.parentElement.parentElement.parentElement.style.left=`${e}px`}}continue}a=MainWindowBrowserManager.m_lastLocation.pathname;let l=g_PopupManager.GetExistingPopup("SP Desktop_uid0").window.document;await r();let s=null;const u=await i(l,"div[class*='Panel'][style*='height: 33px']");if(u){const e=Array.from(u.querySelectorAll("div[style*='left']"));let n=-1/0;e.forEach(e=>{if(e.querySelector("span")){const t=parseFloat(e.style.left.replace("px",""));!isNaN(t)&&t>n&&(n=t,s=e)}})}const _=Array.from(u.querySelectorAll("span")).find(e=>"Delete"===e.textContent.trim());if(_){_.remove(),console.log("Delete button already exists, skipping creation"),a="";continue}const c=s.cloneNode(!0),p=c.querySelector("span");if(null===p){a="";continue}p.textContent="Delete";const d=Number(s.style.left.replace("px",""))+120;console.log(d),c.style.left=d+"px",u.appendChild(c),c.querySelector('[role="button"]').addEventListener("click",function(){console.log("pressed");const e=MainWindowBrowserManager.m_lastLocation.pathname.split("/library/app/")[1];t({id:e}).then(e=>{if(e){const e=()=>{o()};MILLENNIUM_API.showModal(SP_REACT.createElement(MILLENNIUM_API.ConfirmModal,{strTitle:"Succesfully removed game",strDescription:"You need to restart for it to take effect, do you want to do it now?",onOK:e}),g_PopupManager.GetExistingPopup("SP Desktop_uid0").window)}})})}},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(n,t,o){n in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[n]=o,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async n=>{"string"==typeof n.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(n.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let t=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...t,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let o=await t.default();var a;o&&(a=o)&&void 0!==a.title&&void 0!==a.icon&&void 0!==a.content?(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=o,MILLENNIUM_BACKEND_IPC.postMessage(1,{pluginName:pluginName})):console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();