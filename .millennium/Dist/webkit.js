const MILLENNIUM_IS_CLIENT_MODULE=!1,pluginName="steam-app-inserter";function InitializePlugins(){var e,t;let n;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(t=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(t[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(n||(n={}));let a=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],i=`Millennium.Internal.IPC.[${pluginName}]`;const s={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};a.ignoreProxyFlag=!1;const l=e=>new Proxy(e,{set(e,t,n){if(!(t in e))throw new TypeError(`Property ${String(t)} does not exist on plugin settings`);const l=s[e[t].type],o=e[t]?.range;if(l.includes("number")&&"number"==typeof n&&(o&&(n=function(e,t,n){return Math.max(t,Math.min(n,e))}(n,o[0],o[1])),n||(n=0)),!l.includes(typeof n))throw new TypeError(`Expected ${l.join(" or ")}, got ${typeof n}`);return e[t].value=n,((e,t)=>{a.ignoreProxyFlag||SteamClient.BrowserView.PostMessageToParent(i,JSON.stringify({name:e,value:t}))})(String(t),n),!0},get:(e,t)=>"__raw_get_internals__"===t?e:t in e?e[t].value:void 0});a.DefinePluginSetting=l,a.settingsStore=l({})}InitializePlugins();const __call_server_method__=(e,t)=>Millennium.callServerMethod(pluginName,e,t),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,t){"use strict";const n=__wrapped_callable__("Backend.get_dlc_list"),a=__wrapped_callable__("Backend.install_dlcs"),i=__wrapped_callable__("Backend.deletelua"),s=__wrapped_callable__("Backend.checkpirated"),l=__wrapped_callable__("Backend.restart"),o=async(e,n)=>{"function"==typeof t.ShowMessageBox?await Promise.resolve(t.ShowMessageBox({title:e,message:n})):alert(n)},r=(e,t="")=>"string"==typeof e&&e.trim().length?e.trim():"number"==typeof e?String(e):t,d=e=>{if(!e||"object"!=typeof e)return null;const t=e,n=r(t.appid??t.appid);return n?{appid:n,name:r(t.name??t.name,`DLC ${n}`),alreadyInstalled:Boolean(t.alreadyInstalled??t.alreadyInstalled)}:null},c=e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){const t=e,n=(Array.isArray(t.dlc)?t.dlc:[]).map(d).filter(e=>null!==e),a=Boolean(t.success);return{success:a,details:r(t.details,a?"":"Manifest not found on public mirrors. Please request manual access."),dlc:n,appid:r(t.appid,void 0)}}if("string"==typeof e)try{const t=JSON.parse(e);return c(t)}catch{const t=e.toLowerCase().trim();return"true"===t?{success:!0,details:"",dlc:[]}:"false"===t?{success:!1,details:"Manifest not found on public mirrors. Please request manual access.",dlc:[]}:{success:!1,details:e,dlc:[]}}return"boolean"==typeof e?{success:e,details:e?"":"Manifest not found on public mirrors. Please request manual access.",dlc:[]}:{success:!1,details:"Manifest not found on public mirrors. Please request manual access.",dlc:[]}},u=e=>Array.isArray(e)?e.map(e=>r(e)).filter(e=>Boolean(e)):[],p=e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){const t=e;return{success:Boolean(t.success),details:r(t.details),installed:u(t.installed),failed:u(t.failed)}}if("string"==typeof e)try{const t=JSON.parse(e);return p(t)}catch{const t=e.toLowerCase().trim();return"true"===t?{success:!0,details:void 0,installed:[],failed:[]}:"false"===t?{success:!1,details:void 0,installed:[],failed:[]}:{success:!1,details:e,installed:[],failed:[]}}return"boolean"==typeof e?{success:e,details:void 0,installed:[],failed:[]}:{success:!1,details:void 0,installed:[],failed:[]}};return e.default=function(){if(!/^https:\/\/store\.steampowered\.com\/app\//.test(location.href))return;const e="add-app-to-library-btn",t="remove-app-from-library-btn",r=()=>{const e=location.href.match(/\/app\/(\d+)/);return e?e[1]:null},u=async()=>{try{const m=await((e,t=2e4)=>new Promise((n,a)=>{const i=document.querySelector(e);if(i)return n(i);const s=new MutationObserver(()=>{const t=document.querySelector(e);t&&(s.disconnect(),n(t))});s.observe(document.documentElement,{childList:!0,subtree:!0}),setTimeout(()=>{s.disconnect(),a(new Error("timeout"))},t)}))(".apphub_OtherSiteInfo"),y=r();if(!y)return;const g=await s({id:y});document.getElementById(e)?.remove(),document.getElementById(t)?.remove();const f=document.createElement("button");if(f.id=e,f.type="button",f.style.marginRight="3px",f.className="btnv6_blue_hoverfade btn_medium",g){const e=document.createElement("button");e.id=t,e.type="button",e.style.marginRight="3px",e.className="btnv6_blue_hoverfade btn_medium",e.innerHTML="<span>Remove from library</span>",e.addEventListener("click",async t=>{if(t.preventDefault(),confirm("Are you sure you want to remove this game from your library?")){e.disabled=!0,e.innerHTML="<span>Removing...</span>";try{await i({id:y})?confirm("Game removed successfully! Steam needs to restart. Restart now?")?await l():await u():(await o("Unable to remove","Failed to remove the game!"),e.disabled=!1,e.innerHTML="<span>Remove from library</span>")}catch(t){await o("Unable to remove","Error: "+(t?.message??t)),e.disabled=!1,e.innerHTML="<span>Remove from library</span>"}}});const n=m.lastElementChild;n?m.insertBefore(e,n):m.appendChild(e),f.innerHTML="<span>Edit DLC library</span>"}else f.innerHTML="<span>Add to library</span>";f.addEventListener("click",async e=>{e.preventDefault(),f.disabled=!0,f.innerHTML="<span>Loading...</span>";try{const t=await n({appid:y}),i=c(t);if(i.success&&i.dlc&&i.dlc.length){const e=await(async(e,t)=>{const n=t.map(d).filter(e=>null!==e);return!(!n.length||!document.body)&&await new Promise(t=>{const i=document.createElement("div");i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.background="rgba(0, 0, 0, 0.65)",i.style.zIndex="9999",i.style.display="flex",i.style.alignItems="flex-start",i.style.justifyContent="center",i.style.paddingTop="8vh";const s=document.createElement("div");s.style.background="#171a21",s.style.color="#ffffff",s.style.padding="24px",s.style.borderRadius="8px",s.style.maxWidth="520px",s.style.width="calc(100% - 48px)",s.style.boxShadow="0 12px 48px rgba(0, 0, 0, 0.45)",s.style.fontFamily='"Motiva Sans", Arial, sans-serif';const l=document.createElement("h2");l.textContent="Select DLC to add",l.style.margin="0 0 8px 0",s.appendChild(l);const r=document.createElement("p");r.textContent="Select DLC to add. Uncheck any you don't want to add.",r.style.marginTop="0",r.style.fontSize="14px",r.style.opacity="0.85",s.appendChild(r);const d=document.createElement("div");d.style.maxHeight="40vh",d.style.overflowY="auto",d.style.margin="16px 0",d.style.paddingRight="8px",n.forEach(e=>{const t=document.createElement("label");t.dataset.appid=e.appid,t.style.display="flex",t.style.alignItems="center",t.style.gap="10px",t.style.padding="6px 0",t.style.borderBottom="1px solid rgba(255, 255, 255, 0.08)";const n=document.createElement("input");n.type="checkbox",n.value=e.appid;const a=document.createElement("div"),i=document.createElement("div");i.textContent=e.name&&e.name.trim().length?e.name:"DLC "+e.appid;const s=document.createElement("div");s.style.fontSize="12px",s.style.opacity="0.7";const l=[];e.alreadyInstalled&&(l.push("already added"),n.checked=!0),s.textContent=l.join(" - "),a.appendChild(i),s.textContent&&a.appendChild(s),t.appendChild(n),t.appendChild(a),d.appendChild(t)}),s.appendChild(d);const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="flex-end",c.style.gap="12px",c.style.marginTop="16px",c.style.paddingTop="16px";const u=document.createElement("button");u.type="button",u.className="btnv6_lightblue_blue btn_medium",u.textContent="Cancel";const m=document.createElement("button");m.type="button",m.className="btnv6_blue_hoverfade btn_medium",m.textContent="Add selected/Remove unselected";let y=!1;const g=e=>{if(!y){y=!0;try{i.remove()}catch{const e=i.parentNode;e&&e.removeChild(i)}t(e)}},f=e=>{m.disabled=e,u.disabled=e,e?s.setAttribute("aria-busy","true"):s.removeAttribute("aria-busy")};u.addEventListener("click",()=>{g(!1)}),m.addEventListener("click",async()=>{const t=Array.from(d.querySelectorAll('input[type="checkbox"]')).filter(e=>e.checked).map(e=>e.value);f(!0);try{const n=await a({appid:e,dlcs:t}),i=p(n);i.success?g(!0):(f(!1),await o("Adding failed",i.details||"Failed to adding selected DLC"))}catch(e){f(!1),await o("Adding failed",`Error: ${e instanceof Error?e.message:e}`)}}),c.appendChild(u),c.appendChild(m),s.appendChild(c),i.appendChild(s),document.body.appendChild(i)})})(y,i.dlc);e&&confirm("Do you want to restart Steam now?")?await l():await u()}else if(i.success){if(g)await o("No DLC available","This game has no DLC to install.");else{if(!await(async()=>confirm("This game has no DLC. Do you want to add it to your library?"))())return f.disabled=!1,void(f.innerHTML="<span>Add to library</span>");f.innerHTML="<span>Adding...</span>";try{const e=await a({appid:y,dlcs:[]}),t=p(e);if(t.success)return void(confirm("Game added successfully! Steam needs to restart. Restart now?")?await l():await u());await o("Unable to add game",t.details||"Failed to install the base game.")}catch(e){const t=e instanceof Error?e.message:String(e);await o("Unable to add game","Error: "+t)}}f.disabled=!1,f.innerHTML=g?"<span>Edit DLC library</span>":"<span>Add to library</span>"}else await o("Unable to get DLC list",i.details??"Failed to fetch game information."),f.disabled=!1,f.innerHTML=g?"<span>Edit DLC library</span>":"<span>Add to library</span>"}catch(e){await o("Unable to get DLC list","Error: "+(e?.message??e)),f.disabled=!1,f.innerHTML=g?"<span>Edit DLC library</span>":"<span>Add to library</span>"}});const _=m.lastElementChild;_?m.insertBefore(f,_):m.appendChild(f)}catch{setTimeout(u,1e3)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u,{once:!0}):u(),new MutationObserver(()=>{!r()||document.getElementById(e)||document.getElementById(t)||u()}).observe(document.body,{childList:!0,subtree:!0})},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(t,n,a){t in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[t]=a,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async t=>{"string"==typeof t.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(t.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let n=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...n,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let a=await n.default();var i;a&&(i=a)&&void 0!==i.title&&void 0!==i.icon&&void 0!==i.content?window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=a:console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();