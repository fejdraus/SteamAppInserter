const MILLENNIUM_IS_CLIENT_MODULE=!1,pluginName="steam-app-inserter";function InitializePlugins(){var e,t;let n;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(t=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(t[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(n||(n={}));let a=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],i=`Millennium.Internal.IPC.[${pluginName}]`;const l={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};a.ignoreProxyFlag=!1;const s=e=>new Proxy(e,{set(e,t,n){if(!(t in e))throw new TypeError(`Property ${String(t)} does not exist on plugin settings`);const s=l[e[t].type],o=e[t]?.range;if(s.includes("number")&&"number"==typeof n&&(o&&(n=function(e,t,n){return Math.max(t,Math.min(n,e))}(n,o[0],o[1])),n||(n=0)),!s.includes(typeof n))throw new TypeError(`Expected ${s.join(" or ")}, got ${typeof n}`);return e[t].value=n,((e,t)=>{a.ignoreProxyFlag||SteamClient.BrowserView.PostMessageToParent(i,JSON.stringify({name:e,value:t}))})(String(t),n),!0},get:(e,t)=>"__raw_get_internals__"===t?e:t in e?e[t].value:void 0});a.DefinePluginSetting=s,a.settingsStore=s({})}InitializePlugins();const __call_server_method__=(e,t)=>Millennium.callServerMethod(pluginName,e,t),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,t){"use strict";const n=__wrapped_callable__("Backend.get_dlc_list"),a=__wrapped_callable__("Backend.install_dlcs"),i=__wrapped_callable__("Backend.deletelua"),l=__wrapped_callable__("Backend.checkpirated"),s=__wrapped_callable__("Backend.restart"),o=(e,t="primary")=>{const n=document.createElement("button");return n.type="button",n.className="primary"===t?"btnv6_blue_hoverfade btn_medium":"btnv6_lightblue_blue btn_medium",n.textContent=e,n.style.display="inline-flex",n.style.justifyContent="center",n.style.alignItems="center",n.style.minWidth="170px",n.style.padding="0 28px",n.style.minHeight="32px",n.style.boxSizing="border-box",n},r=(e,t)=>{if(!document.body)throw new Error("Document body not ready for dialog rendering.");const n=document.createElement("div");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.background="rgba(0, 0, 0, 0.65)",n.style.zIndex="9999",n.style.display="flex",n.style.alignItems="flex-start",n.style.justifyContent="center",n.style.paddingTop="8vh";const a=document.createElement("div");a.style.background="#171a21",a.style.color="#ffffff",a.style.padding="24px",a.style.borderRadius="8px",a.style.maxWidth="520px",a.style.width="calc(100% - 48px)",a.style.boxShadow="0 12px 48px rgba(0, 0, 0, 0.45)",a.style.fontFamily='"Motiva Sans", Arial, sans-serif',a.style.outline="none",a.tabIndex=-1;const i=document.createElement("h2");if(i.textContent=e,i.style.margin="0 0 8px 0",a.appendChild(i),t){const e=document.createElement("p");e.textContent=t,e.style.marginTop="0",e.style.fontSize="14px",e.style.opacity="0.85",a.appendChild(e)}const l=document.createElement("div");l.style.margin="16px 0",a.appendChild(l);const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="flex-end",s.style.gap="12px",s.style.marginTop="16px",s.style.paddingTop="16px",a.appendChild(s),n.appendChild(a),document.body.appendChild(n);const o=e=>e.stopPropagation();a.addEventListener("click",o);let r=!1;return n.addEventListener("click",()=>{}),requestAnimationFrame(()=>{a.focus()}),{overlay:n,dialog:a,content:l,actions:s,close:()=>{if(!r){r=!0,a.removeEventListener("click",o);try{n.remove()}catch{const e=n.parentNode;e&&e.removeChild(n)}}}}},d=async(e,n)=>{if(!document.body)return"function"==typeof t.ShowMessageBox?void await Promise.resolve(t.ShowMessageBox({title:e,message:n})):void alert(n);await new Promise(t=>{const{dialog:a,content:i,actions:l,close:s}=r(e),d=document.createElement("p");d.textContent=n,d.style.margin="0",d.style.fontSize="14px",d.style.opacity="0.85",i.appendChild(d);let c=!1;const p=()=>{c||(c=!0,s(),t())},m=o("OK","primary");m.addEventListener("click",p),l.appendChild(m),a.addEventListener("keydown",e=>{"Escape"!==e.key&&("Enter"!==e.key||e.shiftKey||e.ctrlKey||e.altKey)||(e.preventDefault(),p())}),requestAnimationFrame(()=>m.focus())})},c=async({title:e,message:t,confirmLabel:n="OK",cancelLabel:a="Cancel"})=>document.body?await new Promise(i=>{const{dialog:l,content:s,actions:d,close:c}=r(e),p=document.createElement("p");p.textContent=t,p.style.margin="0",p.style.fontSize="14px",p.style.opacity="0.85",s.appendChild(p);let m=!1;const u=e=>{m||(m=!0,c(),i(e))},y=o(a,"secondary");y.addEventListener("click",()=>u(!1));const g=o(n,"primary");g.addEventListener("click",()=>u(!0)),d.appendChild(y),d.appendChild(g),l.addEventListener("keydown",e=>{"Escape"===e.key?(e.preventDefault(),u(!1)):"Enter"!==e.key||e.shiftKey||e.ctrlKey||e.altKey||(e.preventDefault(),u(!0))}),requestAnimationFrame(()=>g.focus())}):confirm(t),p=(e,t="")=>"string"==typeof e&&e.trim().length?e.trim():"number"==typeof e?String(e):t,m=e=>{if(!e||"object"!=typeof e)return null;const t=e,n=p(t.appid??t.appid);return n?{appid:n,name:p(t.name??t.name,`DLC ${n}`),alreadyInstalled:Boolean(t.alreadyInstalled??t.alreadyInstalled)}:null},u=e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){const t=e,n=(Array.isArray(t.dlc)?t.dlc:[]).map(m).filter(e=>null!==e),a=Boolean(t.success);return{success:a,details:p(t.details,a?"":"Manifest not found on public mirrors. Please request manual access."),dlc:n,appid:p(t.appid,void 0)}}if("string"==typeof e)try{const t=JSON.parse(e);return u(t)}catch{const t=e.toLowerCase().trim();return"true"===t?{success:!0,details:"",dlc:[]}:"false"===t?{success:!1,details:"Manifest not found on public mirrors. Please request manual access.",dlc:[]}:{success:!1,details:e,dlc:[]}}return"boolean"==typeof e?{success:e,details:e?"":"Manifest not found on public mirrors. Please request manual access.",dlc:[]}:{success:!1,details:"Manifest not found on public mirrors. Please request manual access.",dlc:[]}},y=e=>Array.isArray(e)?e.map(e=>p(e)).filter(e=>Boolean(e)):[],g=e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){const t=e;return{success:Boolean(t.success),details:p(t.details),installed:y(t.installed),failed:y(t.failed)}}if("string"==typeof e)try{const t=JSON.parse(e);return g(t)}catch{const t=e.toLowerCase().trim();return"true"===t?{success:!0,details:void 0,installed:[],failed:[]}:"false"===t?{success:!1,details:void 0,installed:[],failed:[]}:{success:!1,details:e,installed:[],failed:[]}}return"boolean"==typeof e?{success:e,details:void 0,installed:[],failed:[]}:{success:!1,details:void 0,installed:[],failed:[]}};return e.default=function(){if(!/^https:\/\/store\.steampowered\.com\/app\//.test(location.href))return;const e="add-app-to-library-btn",t="remove-app-from-library-btn",p=()=>{const e=location.href.match(/\/app\/(\d+)/);return e?e[1]:null},y=async()=>{try{const f=await((e,t=2e4)=>new Promise((n,a)=>{const i=document.querySelector(e);if(i)return n(i);const l=new MutationObserver(()=>{const t=document.querySelector(e);t&&(l.disconnect(),n(t))});l.observe(document.documentElement,{childList:!0,subtree:!0}),setTimeout(()=>{l.disconnect(),a(new Error("timeout"))},t)}))(".apphub_OtherSiteInfo"),b=p();if(!b)return;const _=await l({id:b});document.getElementById(e)?.remove(),document.getElementById(t)?.remove();const h=document.createElement("button");if(h.id=e,h.type="button",h.style.marginRight="3px",h.className="btnv6_blue_hoverfade btn_medium",_){const e=document.createElement("button");e.id=t,e.type="button",e.style.marginRight="3px",e.className="btnv6_blue_hoverfade btn_medium",e.innerHTML="<span>Remove from library</span>",e.addEventListener("click",async t=>{if(t.preventDefault(),await c({title:"Remove from library",message:"Are you sure you want to remove this game from your library?",confirmLabel:"Remove",cancelLabel:"Cancel"})){e.disabled=!0,e.innerHTML="<span>Removing...</span>";try{await i({id:b})?await c({title:"Restart Steam",message:"Game removed successfully! Steam needs to restart. Restart now?",confirmLabel:"Restart now",cancelLabel:"Later"})?await s():await y():(await d("Unable to remove","Failed to remove the game!"),e.disabled=!1,e.innerHTML="<span>Remove from library</span>")}catch(t){await d("Unable to remove","Error: "+(t?.message??t)),e.disabled=!1,e.innerHTML="<span>Remove from library</span>"}}});const n=f.lastElementChild;n?f.insertBefore(e,n):f.appendChild(e),h.innerHTML="<span>Edit DLC library</span>"}else h.innerHTML="<span>Add to library</span>";h.addEventListener("click",async e=>{e.preventDefault(),h.disabled=!0,h.innerHTML="<span>Loading...</span>";try{const t=await n({appid:b}),i=u(t);if(i.success&&i.dlc&&i.dlc.length){const e=await(async(e,t)=>{const n=t.map(m).filter(e=>null!==e);return!(!n.length||!document.body)&&await new Promise(t=>{const{dialog:i,content:l,actions:s,close:c}=r("Select DLC to add","Select DLC to add. Uncheck any you don't want to add.");l.style.margin="0";const p=document.createElement("div");p.style.maxHeight="40vh",p.style.overflowY="auto",p.style.margin="16px 0",p.style.paddingRight="8px",l.appendChild(p);const m=()=>Array.from(p.querySelectorAll('input[type="checkbox"]')),u=document.createElement("label");u.style.display="flex",u.style.alignItems="center",u.style.gap="10px",u.style.padding="6px 0",u.style.borderBottom="1px solid rgba(255, 255, 255, 0.08)",u.style.cursor="pointer",u.style.margin="0",p.appendChild(u);const y=document.createElement("input");y.type="checkbox",y.title="Select/Unselect all DLC",y.style.transform="scale(1.1)",y.style.cursor="pointer",u.appendChild(y);const f=document.createElement("div");f.textContent="Select/Unselect all DLC",f.style.fontWeight="600",u.appendChild(f);const b=()=>{const e=m();if(!e.length)return y.checked=!1,y.indeterminate=!1,void(y.disabled=!0);y.disabled=!1;const t=e.every(e=>e.checked),n=e.some(e=>e.checked);y.checked=t,y.indeterminate=!t&&n};n.forEach((e,t)=>{const a=document.createElement("label");a.dataset.appid=e.appid,a.style.display="flex",a.style.alignItems="center",a.style.gap="10px",a.style.padding="6px 0",a.style.borderBottom="1px solid rgba(255, 255, 255, 0.08)";const i=document.createElement("input");i.type="checkbox",i.value=e.appid;const l=document.createElement("div"),s=document.createElement("div");s.textContent=e.name&&e.name.trim().length?e.name:"DLC "+e.appid;const o=document.createElement("div");o.style.fontSize="12px",o.style.opacity="0.7";const r=[];e.alreadyInstalled&&(r.push("already added"),i.checked=!0),o.textContent=r.join(" - "),l.appendChild(s),o.textContent&&l.appendChild(o),a.appendChild(i),a.appendChild(l),p.appendChild(a),i.addEventListener("change",()=>{b()}),t===n.length-1&&(a.style.borderBottom="none")});const _=o("Cancel","secondary"),h=o("Add selected/Remove unselected","primary");let L=!1;const w=e=>{L||(L=!0,c(),t(e))},E=e=>{h.disabled=e,_.disabled=e,e?i.setAttribute("aria-busy","true"):i.removeAttribute("aria-busy")};_.addEventListener("click",()=>{w(!1)}),h.addEventListener("click",async()=>{const t=m().filter(e=>e.checked).map(e=>e.value);E(!0);try{const n=await a({appid:e,dlcs:t}),i=g(n);i.success?w(!0):(E(!1),await d("Adding failed",i.details||"Failed to adding selected DLC"))}catch(e){E(!1),await d("Adding failed","Error: "+(e instanceof Error?e.message:e))}}),s.appendChild(_),s.appendChild(h),i.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),w(!1))}),y.addEventListener("change",()=>{const e=m();e.length&&(e.forEach(e=>{e.checked=y.checked}),b())}),b()})})(b,i.dlc);e&&await c({title:"Restart Steam",message:"Changes applied. Steam needs to restart. Restart now?",confirmLabel:"Restart now",cancelLabel:"Later"})?await s():await y()}else if(i.success){if(_)await d("No DLC available","This game has no DLC to install.");else{if(!await(async()=>c({title:"Add to library",message:"This game has no DLC. Do you want to add it to your library?",confirmLabel:"Add game",cancelLabel:"Cancel"}))())return h.disabled=!1,void(h.innerHTML="<span>Add to library</span>");h.innerHTML="<span>Adding...</span>";try{const e=await a({appid:b,dlcs:[]}),t=g(e);if(t.success)return void(await c({title:"Restart Steam",message:"Game added successfully! Steam needs to restart. Restart now?",confirmLabel:"Restart now",cancelLabel:"Later"})?await s():await y());await d("Unable to add game",t.details||"Failed to install the base game.")}catch(e){const t=e instanceof Error?e.message:String(e);await d("Unable to add game","Error: "+t)}}h.disabled=!1,h.innerHTML=_?"<span>Edit DLC library</span>":"<span>Add to library</span>"}else await d("Unable to get DLC list",i.details??"Failed to fetch game information."),h.disabled=!1,h.innerHTML=_?"<span>Edit DLC library</span>":"<span>Add to library</span>"}catch(e){await d("Unable to get DLC list","Error: "+(e?.message??e)),h.disabled=!1,h.innerHTML=_?"<span>Edit DLC library</span>":"<span>Add to library</span>"}});const L=f.lastElementChild;L?f.insertBefore(h,L):f.appendChild(h)}catch{setTimeout(y,1e3)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y,{once:!0}):y(),new MutationObserver(()=>{!p()||document.getElementById(e)||document.getElementById(t)||y()}).observe(document.body,{childList:!0,subtree:!0})},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(t,n,a){t in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[t]=a,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async t=>{"string"==typeof t.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(t.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let n=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...n,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let a=await n.default();var i;a&&(i=a)&&void 0!==i.title&&void 0!==i.icon&&void 0!==i.content?window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=a:console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();